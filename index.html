<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bella Cucina - Build Your Order</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&amp;family=Source+Sans+3:wght@300;400;500;600&amp;display=swap" rel="stylesheet">
  <style>
    html, body { height: 100%; margin: 0; }
  </style>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            'display': ['"Playfair Display"', 'Georgia', 'serif'],
            'body': ['"Source Sans 3"', 'system-ui', 'sans-serif']
          },
          colors: {
            cream: '#FAF7F2',
            charcoal: '#2D2D2D',
            olive: '#6B7B4C',
            terracotta: '#C4784A',
            wine: '#722F37'
          }
        }
      }
    }
  </script>
  <style>body { box-sizing: border-box; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-cream font-body text-charcoal overflow-auto">
  <div id="app" class="w-full min-h-full"><!-- Header -->
   <header class="bg-charcoal text-cream py-8 px-6 text-center">
    <h1 id="restaurant-name" class="font-display text-4xl md:text-5xl font-bold tracking-wide mb-2">Bella Cucina</h1>
    <p id="tagline" class="font-body text-lg font-light tracking-widest uppercase opacity-80">Build Your Perfect Meal</p>
    <div class="mt-6 flex justify-center gap-8 text-sm font-medium"><span class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-olive"></span> Appetizers</span> <span class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-terracotta"></span> Pastas</span> <span class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-wine"></span> Desserts</span>
    </div>
   </header>
   <main class="max-w-5xl mx-auto px-4 py-10"><!-- Appetizers Section -->
    <section class="mb-12">
     <div class="flex items-center gap-4 mb-6"><span class="w-4 h-4 rounded-full bg-olive"></span>
      <h2 class="font-display text-2xl md:text-3xl font-semibold text-charcoal">Appetizers</h2>
      <div class="flex-1 h-px bg-olive opacity-30"></div>
     </div>
     <div class="grid gap-4" id="appetizers-grid"><!-- Appetizer items will be rendered here -->
     </div>
    </section><!-- Pastas Section -->
    <section class="mb-12">
     <div class="flex items-center gap-4 mb-6"><span class="w-4 h-4 rounded-full bg-terracotta"></span>
      <h2 class="font-display text-2xl md:text-3xl font-semibold text-charcoal">Pastas</h2>
      <div class="flex-1 h-px bg-terracotta opacity-30"></div>
     </div>
     <div class="grid gap-4" id="pastas-grid"><!-- Pasta items will be rendered here -->
     </div>
    </section><!-- Desserts Section -->
    <section class="mb-12">
     <div class="flex items-center gap-4 mb-6"><span class="w-4 h-4 rounded-full bg-wine"></span>
      <h2 class="font-display text-2xl md:text-3xl font-semibold text-charcoal">Desserts</h2>
      <div class="flex-1 h-px bg-wine opacity-30"></div>
     </div>
     <div class="grid gap-4" id="desserts-grid"><!-- Dessert items will be rendered here -->
     </div>
    </section><!-- Order Summary -->
    <section class="sticky bottom-0 bg-cream pt-4 pb-6 border-t-2 border-charcoal">
     <div class="bg-charcoal text-cream rounded-2xl p-6 shadow-2xl">
      <div class="flex justify-between items-center mb-4">
       <h3 class="font-display text-xl font-semibold">Your Selection</h3><button id="clear-order" class="text-sm font-medium opacity-70 hover:opacity-100 transition-opacity underline underline-offset-2">Clear All</button>
      </div>
      <div id="order-items" class="space-y-2 max-h-40 overflow-y-auto mb-4">
       <p class="text-cream opacity-60 italic">Select items to begin building your order</p>
      </div>
      <div class="flex justify-between items-center pt-4 border-t border-cream border-opacity-20"><span class="font-medium">Total</span> <span id="order-total" class="font-display text-2xl font-bold">$0.00</span>
      </div>
     </div>
    </section>
   </main>
  </div>
  <script>
    const defaultConfig = {
      restaurant_name: 'Bella Cucina',
      tagline: 'Build Your Perfect Meal',
      background_color: '#FAF7F2',
      text_color: '#2D2D2D',
      accent_color: '#6B7B4C',
      secondary_accent: '#C4784A',
      highlight_color: '#722F37'
    };

    // Menu data
    const menuData = {
      appetizers: [
        { id: 'app1', name: 'Bruschetta Classica', description: 'Grilled bread, vine tomatoes, fresh basil, aged balsamic', price: 9, tags: ['V'] },
        { id: 'app2', name: 'Burrata Fresca', description: 'Creamy burrata, San Marzano tomatoes, basil oil, sea salt', price: 12, tags: ['V', 'GF'] },
        { id: 'app3', name: 'Calamari Fritti', description: 'Lightly fried squid, lemon aioli, fresh herbs', price: 11, tags: [] },
        { id: 'app4', name: 'Arancini al Tartufo', description: 'Truffle risotto balls, fontina, black truffle honey', price: 10, tags: ['V'] },
        { id: 'app5', name: 'Carpaccio di Manzo', description: 'Thinly sliced beef, capers, arugula, shaved parmesan', price: 12, tags: ['GF'] }
      ],
      pastas: [
        { id: 'pas1', name: 'Spaghetti Cacio e Pepe', description: 'Pecorino Romano, black pepper, butter', price: 14, tags: ['V'], addons: true },
        { id: 'pas2', name: 'Rigatoni alla Vodka', description: 'San Marzano tomatoes, vodka cream, basil', price: 15, tags: ['V'], addons: true },
        { id: 'pas3', name: 'Pappardelle al Ragu', description: 'Slow-braised beef, red wine, fresh herbs', price: 18, tags: [], addons: false },
        { id: 'pas4', name: 'Linguine alle Vongole', description: 'Fresh clams, white wine, garlic, parsley', price: 17, tags: [], addons: false },
        { id: 'pas5', name: 'Gnocchi al Pesto', description: 'House-made gnocchi, Genovese basil pesto, pine nuts', price: 16, tags: ['V'], addons: true }
      ],
      desserts: [
        { id: 'des1', name: 'Tiramisu', description: 'Classic mascarpone, espresso-soaked ladyfingers, cocoa', price: 9, tags: ['V'] },
        { id: 'des2', name: 'Panna Cotta', description: 'Vanilla bean cream, seasonal berry compote', price: 8, tags: ['V', 'GF'] },
        { id: 'des3', name: 'Cannoli Siciliani', description: 'Crisp shells, sweet ricotta, chocolate chips, pistachios', price: 7, tags: ['V'] },
        { id: 'des4', name: 'Affogato', description: 'Vanilla gelato, hot espresso, amaretti crumble', price: 6, tags: ['V', 'GF'] },
        { id: 'des5', name: 'Torta al Cioccolato', description: 'Warm chocolate cake, hazelnut gelato, sea salt', price: 9, tags: ['V'] }
      ],
      proteinAddons: [
        { id: 'add1', name: 'Grilled Chicken', price: 5 },
        { id: 'add2', name: 'Italian Sausage', price: 5 },
        { id: 'add3', name: 'Seared Shrimp', price: 7 },
        { id: 'add4', name: 'Prosciutto', price: 6 }
      ]
    };

    // Order state
    let order = [];

    function getTagStyle(tag) {
      const styles = {
        'V': 'bg-olive text-cream',
        'GF': 'bg-terracotta text-cream',
        'VG': 'bg-wine text-cream'
      };
      return styles[tag] || 'bg-charcoal text-cream';
    }

    function getTagLabel(tag) {
      const labels = { 'V': 'Vegetarian', 'GF': 'Gluten-Free', 'VG': 'Vegan' };
      return labels[tag] || tag;
    }

    function getCategoryColor(category) {
      const colors = { appetizers: 'olive', pastas: 'terracotta', desserts: 'wine' };
      return colors[category] || 'charcoal';
    }

    function renderMenuItem(item, category) {
      const color = getCategoryColor(category);
      const isSelected = order.some(o => o.id === item.id && !o.addonFor);
      
      return `
        <div class="bg-white rounded-xl p-5 shadow-sm border-2 transition-all duration-200 cursor-pointer hover:shadow-md ${isSelected ? `border-${color} ring-2 ring-${color} ring-opacity-30` : 'border-transparent'}" 
             data-item-id="${item.id}" data-category="${category}">
          <div class="flex justify-between items-start gap-4">
            <div class="flex-1">
              <div class="flex items-center gap-2 flex-wrap mb-1">
                <h3 class="font-display text-lg font-semibold text-charcoal">${item.name}</h3>
                ${item.tags.map(tag => `<span class="text-xs px-2 py-0.5 rounded-full ${getTagStyle(tag)} font-medium">${getTagLabel(tag)}</span>`).join('')}
              </div>
              <p class="text-sm text-charcoal opacity-70 leading-relaxed">${item.description}</p>
              ${item.addons ? `
                <div class="mt-3 pt-3 border-t border-charcoal border-opacity-10">
                  <p class="text-xs font-semibold uppercase tracking-wide text-${color} mb-2">Add Protein</p>
                  <div class="flex flex-wrap gap-2">
                    ${menuData.proteinAddons.map(addon => {
                      const addonSelected = order.some(o => o.addonFor === item.id && o.id === addon.id);
                      return `
                        <button class="addon-btn text-xs px-3 py-1.5 rounded-full border transition-all ${addonSelected ? `bg-${color} text-cream border-${color}` : `border-charcoal border-opacity-30 text-charcoal hover:border-${color} hover:text-${color}`}"
                                data-addon-id="${addon.id}" data-parent-id="${item.id}" ${!isSelected ? 'disabled' : ''}>
                          ${addon.name} +$${addon.price}
                        </button>
                      `;
                    }).join('')}
                  </div>
                </div>
              ` : ''}
            </div>
            <div class="text-right flex-shrink-0">
              <span class="font-display text-xl font-bold text-${color}">$${item.price}</span>
              <div class="mt-2">
                ${isSelected ? `
                  <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-${color} text-cream text-lg">âœ“</span>
                ` : `
                  <span class="inline-flex items-center justify-center w-8 h-8 rounded-full border-2 border-charcoal border-opacity-30 text-charcoal opacity-50 text-lg">+</span>
                `}
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderOrderSummary() {
      const orderItemsEl = document.getElementById('order-items');
      const orderTotalEl = document.getElementById('order-total');
      
      if (order.length === 0) {
        orderItemsEl.innerHTML = '<p class="text-cream opacity-60 italic">Select items to begin building your order</p>';
        orderTotalEl.textContent = '$0.00';
        return;
      }

      // Group items
      const mainItems = order.filter(o => !o.addonFor);
      let html = '';
      
      mainItems.forEach(item => {
        const addons = order.filter(o => o.addonFor === item.id);
        const itemTotal = item.price + addons.reduce((sum, a) => sum + a.price, 0);
        
        html += `
          <div class="flex justify-between items-start text-sm">
            <div>
              <span class="font-medium">${item.name}</span>
              ${addons.length > 0 ? `<span class="block text-xs opacity-70 ml-2">+ ${addons.map(a => a.name).join(', ')}</span>` : ''}
            </div>
            <span class="font-semibold">$${itemTotal.toFixed(2)}</span>
          </div>
        `;
      });
      
      orderItemsEl.innerHTML = html;
      
      const total = order.reduce((sum, item) => sum + item.price, 0);
      orderTotalEl.textContent = `$${total.toFixed(2)}`;
    }

    function renderMenu() {
      document.getElementById('appetizers-grid').innerHTML = menuData.appetizers.map(item => renderMenuItem(item, 'appetizers')).join('');
      document.getElementById('pastas-grid').innerHTML = menuData.pastas.map(item => renderMenuItem(item, 'pastas')).join('');
      document.getElementById('desserts-grid').innerHTML = menuData.desserts.map(item => renderMenuItem(item, 'desserts')).join('');
      
      renderOrderSummary();
      attachEventListeners();
    }

    function attachEventListeners() {
      // Main item click handlers
      document.querySelectorAll('[data-item-id]').forEach(el => {
        el.addEventListener('click', (e) => {
          if (e.target.closest('.addon-btn')) return;
          
          const itemId = el.dataset.itemId;
          const category = el.dataset.category;
          const allItems = [...menuData.appetizers, ...menuData.pastas, ...menuData.desserts];
          const item = allItems.find(i => i.id === itemId);
          
          const existingIndex = order.findIndex(o => o.id === itemId && !o.addonFor);
          
          if (existingIndex > -1) {
            // Remove item and its addons
            order = order.filter(o => o.id !== itemId && o.addonFor !== itemId);
          } else {
            order.push({ ...item, category });
          }
          
          renderMenu();
        });
      });

      // Addon button handlers
      document.querySelectorAll('.addon-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          if (btn.disabled) return;
          
          const addonId = btn.dataset.addonId;
          const parentId = btn.dataset.parentId;
          const addon = menuData.proteinAddons.find(a => a.id === addonId);
          
          const existingIndex = order.findIndex(o => o.id === addonId && o.addonFor === parentId);
          
          if (existingIndex > -1) {
            order.splice(existingIndex, 1);
          } else {
            order.push({ ...addon, addonFor: parentId });
          }
          
          renderMenu();
        });
      });
    }

    document.getElementById('clear-order').addEventListener('click', () => {
      order = [];
      renderMenu();
    });

    // Element SDK integration
    async function onConfigChange(config) {
      const restaurantName = config.restaurant_name || defaultConfig.restaurant_name;
      const tagline = config.tagline || defaultConfig.tagline;
      const backgroundColor = config.background_color || defaultConfig.background_color;
      const textColor = config.text_color || defaultConfig.text_color;
      
      document.getElementById('restaurant-name').textContent = restaurantName;
      document.getElementById('tagline').textContent = tagline;
      document.body.style.backgroundColor = backgroundColor;
      document.body.style.color = textColor;
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [
          {
            get: () => config.background_color || defaultConfig.background_color,
            set: (value) => { config.background_color = value; window.elementSdk.setConfig({ background_color: value }); }
          },
          {
            get: () => config.text_color || defaultConfig.text_color,
            set: (value) => { config.text_color = value; window.elementSdk.setConfig({ text_color: value }); }
          },
          {
            get: () => config.accent_color || defaultConfig.accent_color,
            set: (value) => { config.accent_color = value; window.elementSdk.setConfig({ accent_color: value }); }
          },
          {
            get: () => config.secondary_accent || defaultConfig.secondary_accent,
            set: (value) => { config.secondary_accent = value; window.elementSdk.setConfig({ secondary_accent: value }); }
          },
          {
            get: () => config.highlight_color || defaultConfig.highlight_color,
            set: (value) => { config.highlight_color = value; window.elementSdk.setConfig({ highlight_color: value }); }
          }
        ],
        borderables: [],
        fontEditable: {
          get: () => config.font_family || 'Playfair Display',
          set: (value) => { config.font_family = value; window.elementSdk.setConfig({ font_family: value }); }
        },
        fontSizeable: {
          get: () => config.font_size || 16,
          set: (value) => { config.font_size = value; window.elementSdk.setConfig({ font_size: value }); }
        }
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ['restaurant_name', config.restaurant_name || defaultConfig.restaurant_name],
        ['tagline', config.tagline || defaultConfig.tagline]
      ]);
    }

    // Initialize
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }

    renderMenu();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cd282dfd1ca4700',t:'MTc3MDk2NjY4MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
